<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Learning eBPF: Setting up the environment | DevCube</title><meta name=keywords content="ebpf,tutorial,linux,kernel"><meta name=description content="For a while, I&rsquo;ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox. You can start with performance profiling, tracing, security, networking, etc. But let&rsquo;s start from the beginning.
By the way, I&rsquo;m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I&rsquo;ll be running some VMs."><meta name=author content="Robert Nemet"><link rel=canonical href=https://rnemet.dev/posts/ebpf/learn-ebpf/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://rnemet.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rnemet.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rnemet.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://rnemet.dev/apple-touch-icon.png><link rel=mask-icon href=https://rnemet.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-L148RQBR36"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-L148RQBR36",{anonymize_ip:!1})}</script><meta property="og:title" content="Learning eBPF: Setting up the environment"><meta property="og:description" content="For a while, I&rsquo;ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox. You can start with performance profiling, tracing, security, networking, etc. But let&rsquo;s start from the beginning.
By the way, I&rsquo;m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I&rsquo;ll be running some VMs."><meta property="og:type" content="article"><meta property="og:url" content="https://rnemet.dev/posts/ebpf/learn-ebpf/"><meta property="og:image" content="https://rnemet.dev/images/box_bee.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-08T09:40:16+02:00"><meta property="article:modified_time" content="2023-05-08T09:40:16+02:00"><meta property="og:site_name" content="DevCube"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rnemet.dev/images/box_bee.jpg"><meta name=twitter:title content="Learning eBPF: Setting up the environment"><meta name=twitter:description content="For a while, I&rsquo;ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox. You can start with performance profiling, tracing, security, networking, etc. But let&rsquo;s start from the beginning.
By the way, I&rsquo;m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I&rsquo;ll be running some VMs."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://rnemet.dev/posts/"},{"@type":"ListItem","position":2,"name":"Learning eBPF: Setting up the environment","item":"https://rnemet.dev/posts/ebpf/learn-ebpf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Learning eBPF: Setting up the environment","name":"Learning eBPF: Setting up the environment","description":"For a while, I\u0026rsquo;ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox. You can start with performance profiling, tracing, security, networking, etc. But let\u0026rsquo;s start from the beginning.\nBy the way, I\u0026rsquo;m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I\u0026rsquo;ll be running some VMs.","keywords":["ebpf","tutorial","linux","kernel"],"articleBody":"For a while, I’ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox. You can start with performance profiling, tracing, security, networking, etc. But let’s start from the beginning.\nBy the way, I’m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I’ll be running some VMs. This setup should be doable on Linux too. Code is available here.\nWhat is eBPF? A lit bit of history A long time ago, in the last century (1992), Steven McCanne and Van Jacobson wrote the paper The BSD Packet Filter. In short, the goal was to tap on a network interface and filter packets. The result is the in-kernel virtual machine that is used to filter packets. This virtual machine is called Berkeley Packet Filter (BPF). It is not only used for filtering packets but also for tracing, performance profiling, security, etc.\nIn 2014, Alexei Starovoitov and Daniel Borkmann started to work on extending BPF. That is how extended BPF (eBPF) was born. eBPF is not only used for filtering packets but as mentioned, eBPF is used for tracing, performance profiling, security, etc.\neBPF virtual machine EBPF program compiles to eBPF bytecode. This bytecode is loaded into the kernel, verified, and then executed by eBPF virtual machine. It uses different maps to communicate with the kernel, store data, and expose data to user space. Above is how eBPF works, in short.\neBPF program is event-driven. It is attached to some hook and executed when that hook is triggered. There are many different hooks that are used, like internal system calls, functions entry and exit, network events, etc.\nWe write eBPF programs in pseudo-C code and then use LLVM to compile it eBPF bytecode. Or we use eBPF programs with projects like Cilium, bcc, and bpftrace. They are abstractions on the top of eBPF and make our life easier. After the program is compiled to eBPF bytecode, it is loaded into the kernel and verified. If everything is ok, eBPF bytecode is translated to native code by the JIT compiler and executed.\nIn the above image, there are eBPF maps. The eBPF programs use them to collect, store and share data. There are different types of eBPF maps, like hash table, array, ring buffer, etc.\nHelper functions, tail, and function calls are not on the image. Helper functions are used to access kernel functions. Tail calls are used to call other eBPF programs. Function calls are used to call other functions inside the eBPF program.\nEnough theory. Let’s start with some practice…\nSetting up the environment (OSX) I’m doing this on OSX. But, even if I do this on a Linux box, I still use VMs. Why? Because I would like to have a clean environment and not mess up my host.\nFirst, I set up a small Git project for messing stuff. I’ll be using it for all my experiments. All code will be in this repo. And I’ll be using VS Code or Community Edition of IntelliJ IDEA. I aim to set up VM(s) to run code and IDE on my host. I should be able to easily share files and run code on VM(s).\nVagrant Vagrant would be a CLI tool for managing VMs. But under the hood, it uses VirtualBox. So, you can use Vagrant and VirtualBox. I’m not VirtualBox fun, but I’ll give it a try.\nI want to use BCC (BPF Compiler Collection) on the first try. BCC is a toolkit for creating efficient kernel tracing and manipulation programs. It is based on eBPF. It is written in Python. So, my Vagrantfile looks like this:\n# -*- mode: ruby -*- # vi: set ft=ruby : $script = \u003c\u003c-SCRIPT echo \"Provisioning...\" sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4052245BD4284CDD echo \"deb https://repo.iovisor.org/apt/$(lsb_release -cs) $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/iovisor.list sudo apt-get update sudo apt-get -y install bcc-tools libbcc-examples linux-headers-$(uname -r) SCRIPT Vagrant.configure(\"2\") do |config| config.vm.box = \"ubuntu/bionic64\" config.vm.provision \"shell\", inline: $script end If you run vagrant up you should get Ubuntu 18.04 LTS VM with BCC installed. You can check it with vagrant ssh and then dpkg -l | grep bcc. You should get something like this:\nii bcc-tools 0.10.0-1 all Command line tools for BPF Compiler Collection (BCC) ii libbcc 0.10.0-1 all Shared Library for BPF Compiler Collection (BCC) ii libbcc-examples 0.10.0-1 amd64 Examples for BPF Compiler Collection (BCC) ii libcc1-0:amd64 8.4.0-1ubuntu1~18.04 amd64 GCC cc1 plugin for GDB ii python-bcc 0.10.0-1 all Python wrappers for BPF Compiler Collection (BCC) Now if you go to /vagrant folder, you’ll see your host folder with Vagrantfile. There I keep my files as well. I have hello.py as Hello World example:\nWell. I want to skip VirtualBox, and I would like to use the newer Ubuntu. So, I decided to try Lima.\nLima According to docs, it is best suited to run on OSX. It uses Hypervisor.framework to run VMs. To install it, you can use brew install lima or see Getting started.\nFor a start, I’m going with this config:\nimages: # Try to use release-yyyyMMdd image if available. Note that release-yyyyMMdd will be removed after several months. - location: \"https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-amd64.img\" arch: \"x86_64\" - location: \"https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img\" arch: \"aarch64\" mounts: - location: \"~\" - location: \"/tmp/lima\" writable: true provision: - mode: system script: | apt-get update apt-get install -y apt-transport-https ca-certificates curl clang llvm jq apt-get install -y libelf-dev libpcap-dev libbfd-dev binutils-dev build-essential make apt-get install -y linux-tools-common linux-tools-5.15.0-41-generic bpfcc-tools apt-get install -y python3-pip rm -rf /usr/local/go \u0026\u0026 tar -C /usr/local -xzf go1.20.3.linux-amd64.tar.gz Just run limactl start --name=ubuntu ubuntu-lst-lima.yml and choose Proceed with the current configuration. When it is done, you can run limactl shell ubuntu to get a shell:\nLima for bpftrace So, in both previous setups, I could run the hello.py example. But I would also like to run bpftrace. For it, I’m creating a separate config:\nimages: # Try to use release-yyyyMMdd image if available. Note that release-yyyyMMdd will be removed after several months. - location: \"https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-amd64.img\" arch: \"x86_64\" - location: \"https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img\" arch: \"aarch64\" mounts: - location: \"~\" - location: \"/tmp/lima\" writable: true provision: - mode: system script: | apt-get update echo \"deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse deb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse deb http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse\" | tee -a /etc/apt/sources.list.d/ddebs.list sudo apt install ubuntu-dbgsym-keyring sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F2EDC64DC5AEE1F6B9C621F0C8CAB6595FDFF622 apt-get update apt-get install -y bpftrace apt-get install -y bpftrace-dbgsym libbpfcc-dbgsym Create VM with limactl start --name=bpftrace bpftrace.yml and run limactl shell bpftrace to get a shell:\nConclusion I’m inviting you to join me on this journey. I set up two VMs with Ubuntu 18.04 LTS and Ubuntu 22.04 LTS. I was able to run hello.py and bpftrace examples. IMHO, this is good enough for a start. For now, I have all I need to start learning eBPF. If you have any suggestions or comments, please, let me know.\nResources Wiki Berkeley Packet Filter The BSD Packet Filter Wiki eBPF eBPF BPF Compiler Collection Vagrant Lima ","wordCount":"1184","inLanguage":"en","image":"https://rnemet.dev/images/box_bee.jpg","datePublished":"2023-05-08T09:40:16+02:00","dateModified":"2023-05-08T09:40:16+02:00","author":{"@type":"Person","name":"Robert Nemet"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rnemet.dev/posts/ebpf/learn-ebpf/"},"publisher":{"@type":"Organization","name":"DevCube","logo":{"@type":"ImageObject","url":"https://rnemet.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://rnemet.dev/ accesskey=h title="Home (Alt + H)"><img src=https://rnemet.dev/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rnemet.dev/posts/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://rnemet.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://rnemet.dev/posts/practical_k8s/ title="Practical k8s"><span>Practical k8s</span></a></li><li><a href=https://rnemet.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://rnemet.dev/about/ title="About Me"><span>About Me</span></a></li><li><a href=https://rnemet.dev/ title><span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Learning eBPF: Setting up the environment</h1><div class=post-description></div><div class=post-meta><span title='2023-05-08 09:40:16 +0200 CEST'>May 8, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Robert Nemet</div></header><figure class=entry-cover><img loading=lazy src=https://rnemet.dev/images/box_bee.jpg alt><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-ebpf aria-label="What is eBPF?">What is eBPF?</a><ul><li><a href=#a-lit-bit-of-history aria-label="A lit bit of history">A lit bit of history</a></li><li><a href=#ebpf-virtual-machine aria-label="eBPF virtual machine">eBPF virtual machine</a></li></ul></li><li><a href=#setting-up-the-environment-osx aria-label="Setting up the environment (OSX)">Setting up the environment (OSX)</a><ul><li><a href=#vagrant aria-label=Vagrant>Vagrant</a></li><li><a href=#lima aria-label=Lima>Lima</a></li><li><a href=#lima-for-bpftrace aria-label="Lima for bpftrace">Lima for bpftrace</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#resources aria-label=Resources>Resources</a></li></ul></div></details></div><div class=post-content><p>For a while, I&rsquo;ve been following stuff around eBPF, and it is very promising. What I just wrote is an understatement. At first glance, eBPF is bringing many new possibilities to our toolbox.
You can start with performance profiling, tracing, security, networking, etc. But let&rsquo;s start from the beginning.</p><p>By the way, I&rsquo;m doing this on OSX. For eBPF, you need Linux kernel 4.1 or newer. So, I&rsquo;ll be running some VMs. This setup should be doable on Linux too. Code is available <a href=https://github.com/robert-nemet/learn-ebpf>here</a>.</p><h2 id=what-is-ebpf>What is eBPF?<a hidden class=anchor aria-hidden=true href=#what-is-ebpf>#</a></h2><h3 id=a-lit-bit-of-history>A lit bit of history<a hidden class=anchor aria-hidden=true href=#a-lit-bit-of-history>#</a></h3><p>A long time ago, in the last century (1992), Steven McCanne and Van Jacobson wrote the paper <a href=https://www.tcpdump.org/papers/bpf-usenix93.pdf>The BSD Packet Filter</a>. In short,
the goal was to tap on a network interface and filter packets. The result is the in-kernel virtual machine that is used to filter packets. This virtual machine
is called Berkeley Packet Filter (BPF). It is not only used for filtering packets but also for tracing, performance profiling, security, etc.</p><p>In 2014, Alexei Starovoitov and Daniel Borkmann started to work on extending BPF. That is how extended BPF (eBPF) was born. eBPF is not only used for filtering packets but as
mentioned, eBPF is used for tracing, performance profiling, security, etc.</p><h3 id=ebpf-virtual-machine>eBPF virtual machine<a hidden class=anchor aria-hidden=true href=#ebpf-virtual-machine>#</a></h3><p><img loading=lazy src=/images/eBPF-short-overview.jpg alt=ebpf-workflow></p><p>EBPF program compiles to eBPF bytecode. This bytecode is loaded into the kernel, verified, and then executed by eBPF virtual machine. It uses different maps to communicate with
the kernel, store data, and expose data to user space. Above is how eBPF works, in short.</p><p>eBPF program is event-driven. It is attached to some hook and executed when that hook is triggered. There are many different hooks that are used, like internal system calls,
functions entry and exit, network events, etc.</p><p>We write eBPF programs in pseudo-C code and then use LLVM to compile it eBPF bytecode. Or we use eBPF programs with projects like Cilium, bcc, and bpftrace. They are abstractions on the top of
eBPF and make our life easier. After the program is compiled to eBPF bytecode, it is loaded into the kernel and verified. If everything is ok, eBPF bytecode is translated to native code by the JIT
compiler and executed.</p><p>In the above image, there are eBPF maps. The eBPF programs use them to collect, store and share data. There are different types of eBPF maps, like hash table, array, ring buffer, etc.</p><p>Helper functions, tail, and function calls are not on the image. Helper functions are used to access kernel functions. Tail calls are used to call other eBPF programs. Function calls
are used to call other functions inside the eBPF program.</p><p>Enough theory. Let&rsquo;s start with some practice&mldr;</p><h2 id=setting-up-the-environment-osx>Setting up the environment (OSX)<a hidden class=anchor aria-hidden=true href=#setting-up-the-environment-osx>#</a></h2><p>I&rsquo;m doing this on OSX. But, even if I do this on a Linux box, I still use VMs. Why? Because I would like to have a clean environment and not mess up my host.</p><p>First, I set up a small Git project for messing stuff. I&rsquo;ll be using it for all my experiments. All code will be in this repo. And I&rsquo;ll be using VS Code or Community Edition of IntelliJ IDEA.
I aim to set up VM(s) to run code and IDE on my host. I should be able to easily share files and run code on VM(s).</p><h3 id=vagrant>Vagrant<a hidden class=anchor aria-hidden=true href=#vagrant>#</a></h3><p><a href=https://developer.hashicorp.com/vagrant>Vagrant</a> would be a CLI tool for managing VMs. But under the hood, it uses <a href=https://www.virtualbox.org/>VirtualBox</a>. So, you can use Vagrant and
VirtualBox. I&rsquo;m not VirtualBox fun, but I&rsquo;ll give it a try.</p><p>I want to use BCC (BPF Compiler Collection) on the first try. BCC is a toolkit for creating efficient kernel tracing and manipulation programs. It is based on eBPF. It is written in Python.
So, my Vagrantfile looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># -*- mode: ruby -*-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># vi: set ft=ruby :</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$script <span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;&lt;-SCRIPT
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>  echo <span style=color:#e6db74>&#34;Provisioning...&#34;</span>
</span></span><span style=display:flex><span>  sudo apt<span style=color:#f92672>-</span>key adv <span style=color:#f92672>--</span>keyserver keyserver<span style=color:#f92672>.</span>ubuntu<span style=color:#f92672>.</span>com <span style=color:#f92672>--</span>recv<span style=color:#f92672>-</span>keys <span style=color:#ae81ff>4052245</span><span style=color:#66d9ef>BD4284CDD</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;deb https://repo.iovisor.org/apt/$(lsb_release -cs) $(lsb_release -cs) main&#34;</span> <span style=color:#f92672>|</span> sudo tee <span style=color:#e6db74>/etc/</span>apt<span style=color:#f92672>/</span>sources<span style=color:#f92672>.</span>list<span style=color:#f92672>.</span>d<span style=color:#f92672>/</span>iovisor<span style=color:#f92672>.</span>list
</span></span><span style=display:flex><span>  sudo apt<span style=color:#f92672>-</span>get update
</span></span><span style=display:flex><span>  sudo apt<span style=color:#f92672>-</span>get <span style=color:#f92672>-</span>y install bcc<span style=color:#f92672>-</span>tools libbcc<span style=color:#f92672>-</span>examples linux<span style=color:#f92672>-</span>headers<span style=color:#f92672>-</span><span style=color:#960050;background-color:#1e0010>$</span>(uname <span style=color:#f92672>-</span>r)
</span></span><span style=display:flex><span><span style=color:#66d9ef>SCRIPT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Vagrant</span><span style=color:#f92672>.</span>configure(<span style=color:#e6db74>&#34;2&#34;</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>config<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>box <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ubuntu/bionic64&#34;</span>
</span></span><span style=display:flex><span>  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>provision <span style=color:#e6db74>&#34;shell&#34;</span>, <span style=color:#e6db74>inline</span>: $script
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>If you run <code>vagrant up</code> you should get Ubuntu 18.04 LTS VM with BCC installed. You can check it with <code>vagrant ssh</code> and then <code>dpkg -l | grep bcc</code>. You should get something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ii  bcc-tools                        0.10.0-1                            all          Command line tools <span style=color:#66d9ef>for</span> BPF Compiler Collection <span style=color:#f92672>(</span>BCC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ii  libbcc                           0.10.0-1                            all          Shared Library <span style=color:#66d9ef>for</span> BPF Compiler Collection <span style=color:#f92672>(</span>BCC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ii  libbcc-examples                  0.10.0-1                            amd64        Examples <span style=color:#66d9ef>for</span> BPF Compiler Collection <span style=color:#f92672>(</span>BCC<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>ii  libcc1-0:amd64                   8.4.0-1ubuntu1~18.04                amd64        GCC cc1 plugin <span style=color:#66d9ef>for</span> GDB
</span></span><span style=display:flex><span>ii  python-bcc                       0.10.0-1                            all          Python wrappers <span style=color:#66d9ef>for</span> BPF Compiler Collection <span style=color:#f92672>(</span>BCC<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Now if you go to <code>/vagrant</code> folder, you&rsquo;ll see your host folder with Vagrantfile. There I keep my files as well. I have <code>hello.py</code> as <code>Hello World</code> example:</p><div id=ebpf_vagrant></div><script src=https://rnemet.dev//js/asciinema-player.min.js></script>
<link rel=stylesheet type=text/css href=https://rnemet.dev//css/asciinema-player.css><script>AsciinemaPlayer.create("/casts/ebpf_vagrant.cast",document.getElementById("ebpf_vagrant"),{autoPlay:"true"})</script><p>Well. I want to skip VirtualBox, and I would like to use the newer Ubuntu. So, I decided to try <a href=https://lima-vm.io/>Lima</a>.</p><h3 id=lima>Lima<a hidden class=anchor aria-hidden=true href=#lima>#</a></h3><p>According to docs, it is best suited to run on OSX. It uses <a href=https://developer.apple.com/documentation/hypervisor>Hypervisor.framework</a> to run VMs. To install it, you can use
<code>brew install lima</code> or see <a href=https://lima-vm.io/#getting-started>Getting started</a>.</p><p>For a start, I&rsquo;m going with this config:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>images</span>:
</span></span><span style=display:flex><span><span style=color:#75715e># Try to use release-yyyyMMdd image if available. Note that release-yyyyMMdd will be removed after several months.</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-amd64.img&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>arch</span>: <span style=color:#e6db74>&#34;x86_64&#34;</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>arch</span>: <span style=color:#e6db74>&#34;aarch64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>mounts</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;~&#34;</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;/tmp/lima&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>writable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>provision</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>system</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get update
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y apt-transport-https ca-certificates curl clang llvm jq
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y libelf-dev libpcap-dev libbfd-dev binutils-dev build-essential make 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y linux-tools-common linux-tools-5.15.0-41-generic bpfcc-tools
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y python3-pip 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.20.3.linux-amd64.tar.gz</span>    
</span></span></code></pre></div><p>Just run <code>limactl start --name=ubuntu ubuntu-lst-lima.yml</code> and choose <code>Proceed with the current configuration</code>. When it is done, you can run <code>limactl shell ubuntu</code> to get a shell:</p><div id=ebpf_lima_ubuntu></div><script src=https://rnemet.dev//js/asciinema-player.min.js></script>
<link rel=stylesheet type=text/css href=https://rnemet.dev//css/asciinema-player.css><script>AsciinemaPlayer.create("/casts/ebpf_lima_ubuntu.cast",document.getElementById("ebpf_lima_ubuntu"),{autoPlay:"true"})</script><h3 id=lima-for-bpftrace>Lima for bpftrace<a hidden class=anchor aria-hidden=true href=#lima-for-bpftrace>#</a></h3><p>So, in both previous setups, I could run the <code>hello.py</code> example. But I would also like to run <a href=https://github.com/iovisor/bpftrace>bpftrace</a>. For it, I&rsquo;m creating a separate config:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>images</span>:
</span></span><span style=display:flex><span><span style=color:#75715e># Try to use release-yyyyMMdd image if available. Note that release-yyyyMMdd will be removed after several months.</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-amd64.img&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>arch</span>: <span style=color:#e6db74>&#34;x86_64&#34;</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;https://cloud-images.ubuntu.com/releases/22.04/release/ubuntu-22.04-server-cloudimg-arm64.img&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>arch</span>: <span style=color:#e6db74>&#34;aarch64&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>mounts</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;~&#34;</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>location</span>: <span style=color:#e6db74>&#34;/tmp/lima&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>writable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>provision</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>system</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get update
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo &#34;deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse deb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse deb http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse&#34; | tee -a /etc/apt/sources.list.d/ddebs.list
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sudo apt install ubuntu-dbgsym-keyring
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F2EDC64DC5AEE1F6B9C621F0C8CAB6595FDFF622
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get update
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y bpftrace 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apt-get install -y bpftrace-dbgsym libbpfcc-dbgsym</span>    
</span></span></code></pre></div><p>Create VM with <code>limactl start --name=bpftrace bpftrace.yml</code> and run <code>limactl shell bpftrace</code> to get a shell:</p><div id=bpftrace></div><script src=https://rnemet.dev//js/asciinema-player.min.js></script>
<link rel=stylesheet type=text/css href=https://rnemet.dev//css/asciinema-player.css><script>AsciinemaPlayer.create("/casts/bpftrace.cast",document.getElementById("bpftrace"),{autoPlay:"true"})</script><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>I&rsquo;m inviting you to join me on this journey. I set up two VMs with Ubuntu 18.04 LTS and Ubuntu 22.04 LTS. I was able to run <code>hello.py</code> and <code>bpftrace</code> examples. IMHO, this is
good enough for a start. For now, I have all I need to start learning eBPF. If you have any suggestions or comments, please, let me know.</p><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ul><li><a href=https://en.wikipedia.org/wiki/Berkeley_Packet_Filter>Wiki Berkeley Packet Filter</a></li><li><a href=https://www.tcpdump.org/papers/bpf-usenix93.pdf>The BSD Packet Filter</a></li><li><a href=https://en.wikipedia.org/wiki/EBPF>Wiki eBPF</a></li><li><a href=https://ebpf.io/>eBPF</a></li><li><a href=https://github.com/iovisor/bcc>BPF Compiler Collection</a></li><li><a href=https://www.vagrantup.com/>Vagrant</a></li><li><a href=https://lima-vm.io/>Lima</a></li></ul><div class=subscribe><iframe src=https://rnemet.substack.com/embed width=480 height=320 style="border:1px solid #eee;background:#fff;margin:auto;display:block" frameborder=0 scrolling=no></iframe></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://rnemet.dev/tags/ebpf/>ebpf</a></li><li><a href=https://rnemet.dev/tags/tutorial/>tutorial</a></li><li><a href=https://rnemet.dev/tags/linux/>linux</a></li><li><a href=https://rnemet.dev/tags/kernel/>kernel</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on twitter" href="https://twitter.com/intent/tweet/?text=Learning%20eBPF%3a%20Setting%20up%20the%20environment&amp;url=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f&amp;hashtags=ebpf%2ctutorial%2clinux%2ckernel"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f&amp;title=Learning%20eBPF%3a%20Setting%20up%20the%20environment&amp;summary=Learning%20eBPF%3a%20Setting%20up%20the%20environment&amp;source=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f&title=Learning%20eBPF%3a%20Setting%20up%20the%20environment"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on whatsapp" href="https://api.whatsapp.com/send?text=Learning%20eBPF%3a%20Setting%20up%20the%20environment%20-%20https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Learning eBPF: Setting up the environment on telegram" href="https://telegram.me/share/url?text=Learning%20eBPF%3a%20Setting%20up%20the%20environment&amp;url=https%3a%2f%2frnemet.dev%2fposts%2febpf%2flearn-ebpf%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://rnemet.dev/>DevCube</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>